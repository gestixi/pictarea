/*! Pictarea v1.1.0 | Â©2016-2019 GestiXi | Licensed under the MIT license */
!function(f){f.fn.pictarea=function(a){return this.each(function(){var c=this,d=f(this),b=d.data("pictarea");if("IMG"!==this.tagName)console.error("pictarea - ERROR: The element must be an img.");else if(!b){var e=d[0].complete,g=f.extend({},f.fn.pictarea.defaults,"object"==typeof a&&a),h=function(){d.data("pictarea",b=new l(c,g));b.drawCanvas(g)};e?h.apply(d[0]):d.on("load",h).attr("src",d.attr("src"))}else if("string"==typeof a)b[a]()})};f.fn.pictarea.defaults={normal:{fillStyle:"rgba(255,255,255,.4)",
strokeStyle:"rgba(255,255,255,.8)",lineWidth:1},hover:{fillStyle:"rgba(255,255,255,.6)",strokeStyle:"#fff",lineWidth:2,shadowColor:"#fff",shadowBlur:10},active:{fillStyle:"rgba(255,255,255,.8)",strokeStyle:"#f00",lineWidth:2},disabled:{fillStyle:"rgba(0,0,0,.4)",strokeStyle:"transparent"},areaValueKey:"target",areaDisableKey:"disabled",maxSelections:1,rescaleOnResize:!1};var l=function(a,c){var d=this;d.options=c;d.img=a;var b=d.$img=f(a);d.src=b.attr("src");d.imgWidth=a.naturalWidth||a.width;d.imgHeight=
a.naturalHeight||a.height;b=this.$img;var e=b.attr("usemap");if(e){var g={position:"absolute",top:0,left:0,right:0,bottom:0};e=this.$map=f('map[name="'+e.substr(1)+'"]');this.$initialMap=e.clone();var h=f('<div class="pictarea"></div>').css({position:"relative"}),k=b.clone().attr({id:null,"class":"pictarea-img",usemap:null}).css(g);g=this.createCanvas().css(g);b.before(h).css("opacity",0).remove();h.append(k);h.append(g);h.append(b);this.drawCanvas();e.on("mouseover",function(a){d.mouseover(a)}).on("mouseout",
function(a){d.mouseout(a)}).on("click touchstart",function(a){d.select(a);a.preventDefault()});c.rescaleOnResize&&f(window).resize(function(a){d.scheduleRedraw()})}else console.error("pictarea - ERROR: The img element must have a usemap attribute.")};f.fn.pictarea.Constructor=l;l.prototype={constructor:l,hovered:null,selection:null,value:null,createCanvas:function(){var a=f('<canvas style="width:100%;height:100%;"></canvas>');this.canvas=a[0];return this.$canvas=a},drawCanvas:function(){var a=this.canvas;
a.width=a.offsetWidth;a.height=a.offsetHeight;a.getContext("2d").clearRect(0,0,a.offsetWidth,a.offsetHeight);this.drawZones()},drawZones:function(){var a=this,c=this.$map,d=this.$initialMap.find("area");c.find("area").each(function(b){a.drawZone(this,d[b])})},drawZone:function(a,c){var d=this.canvas.getContext("2d"),b=f(a),e=b.attr("shape").toLowerCase().substr(0,4);if(c){for(var g=f(c).attr("coords").split(","),h=this.imgWidth/this.canvas.offsetWidth,k=0;k<g.length;k++)g[k]=parseFloat(g[k])/h;b.attr("coords",
g.join(","))}b=b.attr("coords").split(",");for(k=0;k<b.length;k++)b[k]=parseFloat(b[k]);d.save();this.drawShape(e,b);this.styleShape(a);d.restore()},drawShape:function(a,c){var d=this.canvas.getContext("2d");d.beginPath();if("rect"===a)d.rect(c[0],c[1],c[2]-c[0],c[3]-c[1]);else if("poly"===a){d.moveTo(c[0],c[1]);for(var b=2;b<c.length;b+=2)d.lineTo(c[b],c[b+1])}else"circ"===a&&d.arc(c[0],c[1],c[2],0,2*Math.PI,!1);d.closePath()},styleShape:function(a){var c=this.canvas.getContext("2d"),d=this.options,
b=d.areaDisableKey,e=d.normal;b&&a.hasAttribute(b)?e=d.disabled:(a===this.hovered&&(e=f.extend({},e,d.hover)),this.selection&&-1<this.selection.indexOf(a)&&(e=f.extend({},e,d.active)));f.extend(c,e);c.fill();c.stroke()},mouseover:function(a){var c=a.target;c&&(a=f.Event("enterArea.pictarea",{originalEvent:a,area:c,pictarea:this}),this.$img.trigger(a),a.isDefaultPrevented()||(this.hovered=c,this.drawCanvas()))},mouseout:function(a){var c=a.target;c&&(a=f.Event("leaveArea.pictarea",{originalEvent:a,
area:c,pictarea:this}),this.$img.trigger(a),a.isDefaultPrevented()||(this.hovered=null,this.drawCanvas()))},select:function(a){var c=a.target,d=this.options,b=d.areaDisableKey;if(!b||!c.hasAttribute(b)){var e=d.areaValueKey;b=this.selection;var g=null,h=f.Event("selectArea.pictarea",{originalEvent:a,area:c,key:e?c.getAttribute(e):null,pictarea:this});this.$img.trigger(h);if(!h.isDefaultPrevented()){b||(b=[]);h=b.indexOf(c);var k=d.maxSelections;for(-1===h?b.push(c):b.splice(h,1);0<=k&&b.length>d.maxSelections;)b.shift();
e&&(1===k?b[0]&&(g=b[0].getAttribute(e)):1<k&&(g=[],b.forEach(function(a){(a=a.getAttribute(e))&&g.push(a)})));this.selection=b;this.value=g;this.drawCanvas();a=f.Event("change.pictarea",{originalEvent:a,area:c,selection:b,value:g,pictarea:this});this.$img.trigger(a)}}},destroy:function(){this._isDestroyed=!0;this.$img.removeData("pictarea")},scheduleRedraw:function(){if(!this._didScheduleScale)if(window.requestAnimationFrame){var a=this;this._didScheduleScale=!0;requestAnimationFrame(function(){a.drawCanvas()})}else this.drawCanvas()}}}(window.jQuery);